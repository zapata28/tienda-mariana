<!-- ================= HERO CAROUSEL ================= -->
<section
  class="hero-carousel"
  (mouseenter)="pauseAutoplay()"
  (mouseleave)="resumeAutoplay()"
  (touchstart)="pauseAutoplay()"
  (touchend)="resumeAutoplay()"
>
  <div
    class="slide"
    *ngFor="let slide of slides; let i = index"
    [class.active]="i === currentSlide"
  >
 
    <img
      class="slide-bg"
      [src]="slide.image"
      [alt]="slide.title"
      [attr.loading]="i === 0 ? 'eager' : 'lazy'"
      decoding="async"
      [attr.fetchpriority]="i === 0 ? 'high' : 'low'"
    />

    <div class="content">
      <h1>{{ slide.title }}</h1>
      <p>{{ slide.text }}</p>
      <button type="button">{{ slide.button }}</button>
    </div>
  </div>

  <div class="dots">
    <span
      class="dot"
      *ngFor="let slide of slides; let i = index"
      [class.active]="i === currentSlide"
      (click)="goToSlide(i)"
    ></span>
  </div>
</section>


<!-- ================= NOVEDADES ================= -->
<section class="section-title">
  <h2>NOVEDADES</h2>
</section>

<section class="novedades-container">
  <div *ngIf="loadingNovedades" style="padding: 10px 20px;">
    Cargando novedades...
  </div>

  <cdk-virtual-scroll-viewport
    *ngIf="!loadingNovedades"
    itemSize="340"
    class="virtual-viewport"
  >
    <article
      class="producto-card"
      *cdkVirtualFor="let p of novedades"
      (click)="verProducto(p.id)"
    >
      <div class="producto-img">
        <img
          [src]="p.imagen || 'img/placeholder.png'"
          [alt]="p.nombre"
          loading="lazy"
          decoding="async"
        />

        <span class="badge badge-nuevo" *ngIf="p.es_nuevo">Nuevo</span>

        <span class="badge badge-oferta" *ngIf="p.en_oferta && p.precio_antes">
          -{{ descuentoPct(p) }}%
        </span>
      </div>

      <div class="producto-info">
        <h3>{{ p.nombre }}</h3>
        <p class="desc">{{ p.descripcion }}</p>

        <div class="precio-row">
          <div class="precios">
            <span class="precio">
              {{ p.precio | currency:'COP':'symbol':'1.0-0' }}
            </span>
            <span class="precio-antes" *ngIf="p.precio_antes">
              {{ p.precio_antes | currency:'COP':'symbol':'1.0-0' }}
            </span>
          </div>

          <div class="acciones">
            <button
              class="btn-add"
              type="button"
              (click)="addToCart(p); $event.stopPropagation()"
              aria-label="Agregar al carrito"
            >
              <svg class="btn-icon" viewBox="0 0 24 24">
                <path
                  d="M11 5a1 1 0 0 1 1 1v5h5a1 1 0 1 1 0 2h-5v5a1 1 0 1 1-2 0v-5H6a1 1 0 1 1 0-2h5V6a1 1 0 0 1 1-1z"
                ></path>
              </svg>
              <span class="btn-text">Agregar</span>
            </button>
          </div>
        </div>
      </div>
    </article>
  </cdk-virtual-scroll-viewport>
</section>

<!-- ================= CATEGORÃAS ================= -->
<section class="categoria-container">
  <div class="horizontal-scroll">
    <div class="card" *ngFor="let item of categorias" (click)="irACategoria(item.slug)">
      <img
        [src]="item.img"
        [alt]="item.name"
        loading="lazy"
        decoding="async"
      />
      <div class="card-info">
        <span class="text">{{ item.name }}</span>
      </div>
    </div>
  </div>
  <div class="franja"></div>
</section>

<!-- ================= DESCUENTOS ================= -->
<section class="section-title">
  <h2>DESCUENTOS</h2>
</section>

<section class="novedades-container">
  <div *ngIf="loadingOfertas" style="padding: 10px 20px;">
    Cargando descuentos...
  </div>

  <cdk-virtual-scroll-viewport
    *ngIf="!loadingOfertas"
    itemSize="340"
    class="virtual-viewport"
  >
    <article
      class="producto-card"
      *cdkVirtualFor="let p of ofertas"
      (click)="verProducto(p.id)"
    >
      <div class="producto-img">
        <img
          [src]="p.imagen || 'img/placeholder.png'"
          [alt]="p.nombre"
          loading="lazy"
          decoding="async"
        />

        <span class="badge badge-oferta" *ngIf="p.precio_antes">
          -{{ descuentoPct(p) }}%
        </span>
      </div>

      <div class="producto-info">
        <h3>{{ p.nombre }}</h3>
        <p class="desc">{{ p.descripcion }}</p>

        <div class="precio-row">
          <div class="precios">
            <span class="precio">
              {{ p.precio | currency:'COP':'symbol':'1.0-0' }}
            </span>
            <span class="precio-antes" *ngIf="p.precio_antes">
              {{ p.precio_antes | currency:'COP':'symbol':'1.0-0' }}
            </span>
          </div>

          <div class="acciones">
            <button
              class="btn-add"
              type="button"
              (click)="addToCart(p); $event.stopPropagation()"
            >
              Agregar
            </button>
          </div>
        </div>
      </div>
    </article>
  </cdk-virtual-scroll-viewport>
</section>
