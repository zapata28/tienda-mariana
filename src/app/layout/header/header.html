<!-- TOP BAR -->
<div class="top-bar">
  <span>EnvÃ­o gratis por compras superiores a $150.000</span>
</div>

<!-- OVERLAY (menu, carrito o menÃº usuario) -->
<div
  class="overlay"
  [class.active]="menuOpen || cartOpen || userMenuOpen"
  (click)="closeAll()"
></div>

<!-- HEADER -->
<header class="header">
  <!-- LOGO â†’ HOME -->
  <a class="logo" routerLink="/" (click)="closeAll()">
    <img src="/plegaria.png" alt="Logo" />
    <span>PLEGARIA</span>
  </a>

  <!-- NAV (categorÃ­as) -->
  <nav [class.open]="menuOpen">
    <a
      routerLink="/categoria/maquillaje"
      routerLinkActive="active"
      (click)="closeAll()"
    >
      Maquillaje
    </a>

    <a
      routerLink="/categoria/skincare"
      routerLinkActive="active"
      (click)="closeAll()"
    >
      Cuidado de la piel
    </a>

    <a
      routerLink="/categoria/capilar"
      routerLinkActive="active"
      (click)="closeAll()"
    >
      Cuidado capilar
    </a>

    <a
      routerLink="/categoria/accesorios"
      routerLinkActive="active"
      (click)="closeAll()"
    >
      Accesorios
    </a>
  </nav>

  <!-- ICONS -->
  <div class="icons">

    <!-- BUSQUEDA -->
<div class="search" (click)="$event.stopPropagation()">
<button
  class="icon-btn"
  type="button"
  (click)="toggleSearch()"
  aria-label="Buscar"
  title="Buscar"
>
  <svg class="search-icon" viewBox="0 0 24 24">
    <circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="2"/>
    <line x1="16.65" y1="16.65" x2="21" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
  </svg>
</button>

  <!-- Input desplegable -->
  <div class="search-box" *ngIf="searchOpen">
    <input
      type="text"
      placeholder="Buscar productosâ€¦"
      [(ngModel)]="searchTerm"
      (keydown.enter)="goSearch()"
    />
    <button type="button" (click)="goSearch()">âžœ</button>
  </div>
</div>

    <!-- CARRITO -->
    <button
      class="cart-btn"
      type="button"
      (click)="toggleCart()"
      aria-label="Carrito"
      title="Carrito"
    >
      <svg class="cart-icon" viewBox="0 0 24 24" aria-hidden="true">
        <path
          fill="currentColor"
          d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10
          0c-1.1 0-1.99.9-1.99 2S15.9 22 17 22s2-.9 2-2-.9-2-2-2zM7.16
          14h9.45c.75 0 1.4-.41 1.74-1.03l3.58-6.49A1 1 0 0 0 21.08 5H6.21L5.27
          3H2v2h2l3.6 7.59-1.35 2.44C5.52 16.37 6.48 18 8 18h12v-2H8l1.16-2z"
        />
      </svg>

      <span class="cart-badge" *ngIf="cart.countSig() > 0">
        {{ cart.countSig() > 99 ? '99+' : cart.countSig() }}
      </span>
    </button>

    <!-- CUENTA / LOGIN (MISMO ICONO ðŸ‘¤) -->
    <div class="account" (click)="$event.stopPropagation()">
      <!-- Si NO estÃ¡ logueado -> va a login -->
      <a
  *ngIf="!auth.isLoggedIn()"
  class="icon-btn"
  routerLink="/login"
  (click)="closeAll()"
  aria-label="Login"
  title="Login"
>
  <svg class="user-icon" viewBox="0 0 24 24">
    <path
      fill="currentColor"
      d="M12 12c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm0
      2c-3.33 0-10 1.67-10 5v3h20v-3c0-3.33-6.67-5-10-5z"
    />
  </svg>
</a>

      <!-- Si SÃ estÃ¡ logueado -> abre menÃº -->
      <button
        *ngIf="auth.isLoggedIn()"
        class="icon-btn"
        type="button"
        (click)="toggleUserMenu()"
        [class.active]="userMenuOpen"
        aria-label="Cuenta"
        title="Cuenta"
      >
        ðŸ‘¤
      </button>

      <!-- Dropdown: Panel + Cerrar sesiÃ³n -->
      <div class="user-menu" *ngIf="auth.isLoggedIn() && userMenuOpen">
        <a class="user-item" routerLink="/admin" (click)="closeAll()">
          Panel
        </a>

        <button class="user-item danger" type="button" (click)="salir()">
          âŽ‹ Cerrar sesiÃ³n
        </button>
      </div>
    </div>
  </div>

  <!-- MINI CARRITO (dentro del header) -->
  <div class="mini-cart" *ngIf="cartOpen">
    <div class="mini-top">
      <strong>Carrito</strong>
      <button class="mini-close" type="button" (click)="closeCart()">âœ•</button>
    </div>

    <div class="mini-empty" *ngIf="cart.itemsSig().length === 0">
      EstÃ¡ vacÃ­o.
    </div>

    <div class="mini-list" *ngIf="cart.itemsSig().length">
      <div class="mini-item" *ngFor="let it of cart.itemsSig()">
        <div class="mini-name">{{ it.nombre }}</div>

        <div class="mini-right">
          <span class="mini-qty">x{{ it.qty }}</span>
          <button class="mini-del" type="button" (click)="cart.remove(it.id)">
            Quitar
          </button>
        </div>
      </div>

      <div class="mini-sub">
        <span>Subtotal</span>
        <strong>{{ cart.subtotalSig() | currency:'COP':'symbol':'1.0-0' }}</strong>
      </div>

      <a class="mini-go" routerLink="/carrito" (click)="closeAll()">
        Ir al carrito
      </a>
    </div>
  </div>
</header>
